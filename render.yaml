

databases:
  - name: mysql-user-db
    databaseName: employee_system     # must be lower-case + underscores
    user: root
    plan: starter

  - name: mysql-task-db
    databaseName: task_db
    user: root
    plan: starter

services:

  # ---------- Service Registry ----------
  - type: web
    name: eureka-server
    runtime: image
    image:
      url: docker.io/sapuninethmini/eureka-service:latest
    plan: starter
    region: oregon
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: EUREKA_CLIENT_REGISTER_WITH_EUREKA
        value: "false"
      - key: EUREKA_CLIENT_FETCH_REGISTRY
        value: "false"
      - key: SERVER_PORT
        value: "8761"

  # ---------- API Gateway ----------
  - type: web
    name: api-gateway
    runtime: image
    image:
      url: docker.io/sapuninethmini/taskmaster-api-getway:latest
    plan: starter
    region: oregon
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SERVER_PORT
        value: "8080"
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://eureka-server.onrender.com/eureka/

  # ---------- User Service ----------
  - type: web
    name: user-service
    runtime: image
    image:
      url: docker.io/sapuninethmini/taskmaster-user-service:latest
    plan: starter
    region: oregon
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SERVER_PORT
        value: "8082"
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://eureka-server.onrender.com/eureka/
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: mysql-user-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: mysql-user-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: mysql-user-db
          property: password

  # ---------- Task Service ----------
  - type: web
    name: task-service
    runtime: image
    image:
      url: docker.io/sapuninethmini/taskmaster-task-service:latest
    plan: starter
    region: oregon
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SERVER_PORT
        value: "8084"
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://eureka-server.onrender.com/eureka/
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: mysql-task-db
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: mysql-task-db
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: mysql-task-db
          property: password

  # ---------- Notification Service ----------
  - type: web
    name: notification-service
    runtime: image
    image:
      url: docker.io/sapuninethmini/taskmaster-notification-service:latest
    plan: starter
    region: oregon
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: docker
      - key: SERVER_PORT
        value: "8085"
      - key: EUREKA_CLIENT_SERVICEURL_DEFAULTZONE
        value: https://eureka-server.onrender.com/eureka/
      - key: EMAIL_USERNAME
        value: saragamage111@gmail.com      # replace with secret in dashboard
      - key: EMAIL_PASSWORD
        value: Kusum2000                    # replace with secret in dashboard

  # ---------- Front-end (Angular) ----------
  - type: web
    name: taskmaster-frontend
    runtime: image                          # stays a Docker image
    image:
      url: docker.io/sapuninethmini/taskmaster-frontend:latest
    plan: starter
    region: oregon
    healthCheckPath: /                      # simple check for index.html
    envVars:
      - key: API_BASE_URL
        value: https://api-gateway.onrender.com
